package zx9.web.dao;

import java.util.List;

import org.apache.ibatis.session.SqlSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import chain.Util;
import zx9.web.vo.BankVO;
import zx9.web.vo.BlistVO;

@Repository
public class BlistDaoImpl implements BlistDao {

	@Autowired
	private SqlSession sqlSession;// 자동 의존성 주입 => mybatis쿼리문 수행객체

	

	@Override
	public void update_rest(BlistVO blv, BankVO bv) {
		// TODO Auto-generated method stub
		blv.setBrest(bv.getBrest());
		blv.setBid(bv.getBid());
		//blv.setPrehash(prehash);
		
		int bsequence=sqlSession.selectOne("selectseq");
		BlistVO newblvo=sqlSession.selectOne("selectseqall",bsequence);
		Integer a;
		Integer b;
		if(newblvo!=null) {
			 a=newblvo.getBinout();
			 b=newblvo.getBrest();
		String prehash=newblvo.getBmemo()+newblvo.getBuser()+a.toString()+b.toString();
		System.out.println("pre : "+prehash);
		if(newblvo.getPrehash()!=null) {
				prehash+=newblvo.getPrehash();
			}
		blv.setPrehash(prehash);
		}
		 a=blv.getBinout();
		 b=blv.getBrest();
		String thishash=blv.getBmemo()+blv.getBuser()+a.toString()+b.toString();

		System.out.println("this :"+thishash);
		if(blv.getPrehash()!=null) {
		 thishash+=blv.getPrehash();
		}
	
		blv.setThishash(thishash);
		
		
		
		sqlSession.update("update_Blrest",blv);
	}



	@Override
	public List<BlistVO> select_list(BlistVO bl) {
		// TODO Auto-generated method stub
		
		return sqlSession.selectList("select_list", bl);

	}



	@Override
	public int getCount(String bid) {
		// TODO Auto-generated method stu
		
		return sqlSession.selectOne("getlistC",bid);
	}
	@Override
	public void sendmsg(BlistVO blv) {
		// TODO Auto-generated method stub
		sqlSession.insert("sendmsg",blv);
		
		
		
	}



	@Override
	public void fileio(BlistVO blvo) {
		// TODO Auto-generated method stub
		sqlSession.update("fileupload_bank",blvo);
	}



	@Override
	public List<String> selectallfile() {
		// TODO Auto-generated method stub

		return sqlSession.selectList("fileselect");
	}

}
